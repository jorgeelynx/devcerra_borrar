/**
 * orderfiles Prestashop module
 *
 * NOTICE OF LICENSE
 *
 * This file is licenced under the Software License Agreement
 * With the purchase or the installation of the software in your application
 * you accept the licence agreement.
 * You must not modify, adapt or create derivative works of this source code
 *
 * @author    Wiktor Koźmiński
 * @copyright 2017-2017 Silver Rose Wiktor Koźmiński
 * @license   LICENSE.txt
 */
var OrderFilesUploader=function(){function a(a){this.options=a,this.validateOptions(),this.createElements(),this.initListeners(),this.setCurrentFile(null)}return a.prototype.validateOptions=function(){var a=this.options;if(!a.dropArea)throw"Drop area element reference is missing";if(!a.sendFileBtn)throw"Send button reference is missing";a.varNames||(a.varNames={file:"cartfile",desc:"desc"})},a.prototype.createElements=function(){var a=this.fileInput=document.createElement("input");a.type="file",a.style.display="none",a.name="orderfile-hidden",this.options.dropArea.innerHTML='<span class="hint">'+this.options.hintText+'</span><span class="file-name"></span>',this.options.dropArea.appendChild(a)},a.prototype.initListeners=function(){var a=this,b=this,c=this.options.dropArea;c.addEventListener("click",function(a){b.fileInput.click()}),c.addEventListener("dragover",function(a){a.preventDefault()}),c.addEventListener("dragenter",function(a){this.classList.add("drag-hover")}),c.addEventListener("dragleave",function(a){this.classList.remove("drag-hover")}),c.addEventListener("drop",function(a){a.preventDefault(),this.classList.remove("drag-hover"),a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length&&b.setCurrentFile(a.dataTransfer.files[0])}),this.fileInput.addEventListener("change",function(a){return!(!this.files||!this.files.length)&&void b.setCurrentFile(this.files[0])}),this.options.sendFileBtn.addEventListener("click",function(b){return!!a.currentFile&&void a.uploadFile(a.currentFile)})},a.prototype.setCurrentFile=function(a){var b=this.options.dropArea;this.currentFile=a,this.currentFile?this.options.sendFileBtn.removeAttribute("disabled"):this.options.sendFileBtn.setAttribute("disabled",""),b.querySelector(".hint").style.display=this.currentFile?"none":null,b.querySelector(".file-name").style.display=this.currentFile?null:"none",b.querySelector(".file-name").innerHTML=this.currentFile?this.currentFile.name:"No file"},a.prototype.uploadFile=function(a){var b=this,c=new FormData,d=this.options,e=d.varNames.file?d.varNames.file:"cartfile";if(c.append(e,a,a.name),d.fileDescInput){var f=d.varNames.desc?d.varNames.desc:"desc";c.append(f,d.fileDescInput.value)}var g=new XMLHttpRequest;g.upload.addEventListener("progress",function(a){"function"==typeof d.onProgress&&d.onProgress(a.loaded,a.total)}),g.onreadystatechange=function(){4==g.readyState&&(b.setCurrentFile(null),"function"==typeof d.onFileSent&&d.onFileSent(g.response))};var h=d.uploadUrl;h||(h=window.location.href),g.open("POST",h),g.send(c)},a}();